# âš™ï¸ äºŒã€ç ”å‘è®¾è®¡æ–‡æ¡£ï¼ˆRDDï¼‰

**é¡¹ç›®åç§°ï¼š** Aè‚¡ææ…ŒæŒ‡æ•°ç³»ç»Ÿ  
**ç‰ˆæœ¬ï¼š** v1.0  
**ä½œè€…ï¼š** Vive

---

## 1. ç³»ç»Ÿæ¶æ„æ€»è§ˆ
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚        Airflow       â”‚
                      â”‚  fetch â†’ clean â†’ NLP â”‚
                      â”‚  â†’ calc â†’ store â†’ visâ”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                 Data Pipeline               â”‚
      â”‚ 1. fetch_data.py  | è°ƒ Tushareã€RSS          â”‚
      â”‚ 2. clean_data.py  | æ•°æ®æ¸…æ´— & æ ¼å¼åŒ–         â”‚
      â”‚ 3. store_data.py  | å…¥ PostgreSQL           â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚     PostgreSQL æ•°æ®åº“         â”‚
               â”‚ raw_data / clean_data /      â”‚
               â”‚  fear_index / news_sentiment â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ DeepSeek API                 â”‚
               â”‚ ææ…ŒåŸå› åˆ†æ                   â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ Streamlit Dashboard          â”‚
               â”‚ å·¦è¡¨æ ¼ + å³æœç´¢ + æŠ˜çº¿ + AIæ€»ç»“ â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

---

## 2. æ¨¡å—è®¾è®¡

### (1) æ•°æ®é‡‡é›†æ¨¡å—

**æ–‡ä»¶è·¯å¾„ï¼š** `data_pipeline/fetch_data.py`

| æ¥æº | æŠ€æœ¯ | æ•°æ®ç±»å‹ |
|------|------|-----------|
| Tushare | API | Aè‚¡æ¯æ—¥è¡Œæƒ…æ•°æ®ï¼ˆopen, close, high, low, volumeï¼‰ï¼›åŒ—å‘èµ„é‡‘æ¯æ—¥æµå…¥æµå‡ºæ•°æ® |
| æ–°é—»ç½‘ç«™ï¼šä¸œæ–¹è´¢å¯Œç½‘ | rss | è´¢ç»æ–°é—»æ ‡é¢˜ã€æ­£æ–‡ã€å‘å¸ƒæ—¶é—´ |

---

### (2) æ•°æ®æ¸…æ´—æ¨¡å—ï¼ˆETLä»»åŠ¡ï¼‰

**æ–‡ä»¶è·¯å¾„ï¼š** `data_pipeline/clean_data.py`  
**æ‰§è¡Œæ–¹å¼ï¼š** ç”± Airflow DAG å®šæ—¶æ‰§è¡Œ

**ä¸»è¦é€»è¾‘ï¼š**
- å»é™¤é‡å¤è¡Œã€ç©ºå€¼  
- ç»Ÿä¸€æ—¥æœŸæ ¼å¼  
- æ£€æµ‹å¹¶ä¿®æ­£ä»·æ ¼å¼‚å¸¸  
- ä½¿ç”¨åœç”¨è¯è¡¨æ¸…æ´—èˆ†æƒ…æ–‡æœ¬  
- æå–æƒ…æ„Ÿå…³é”®è¯ï¼ˆä¸ºåç»­NLPåˆ†æå‡†å¤‡ï¼‰

---

### (3) èˆ†æƒ…åˆ†ææ¨¡å—ï¼ˆNLPï¼‰

**æ–‡ä»¶è·¯å¾„ï¼š** `analysis/nlp_sentiment.py`

**åŠŸèƒ½ï¼š**
- ä¼ å…¥æ¸…æ´—åçš„èˆ†æƒ…æ–‡æœ¬  
- ä½¿ç”¨ â€‹æœ¬åœ° NLP æ–¹æ³•â€‹ è¿›è¡Œæƒ…æ„Ÿåˆ†æï¼Œè¿”å›ï¼š
  - æƒ…ç»ªå€¾å‘ï¼ˆæ­£å‘ / è´Ÿå‘ / ä¸­æ€§ï¼‰
  - ææ…Œå…³é”®è¯åˆ—è¡¨ï¼ˆå¦‚â€œæš´è·Œâ€â€œå´©ç›˜â€â€œå±æœºâ€ç­‰ï¼‰
  - ææ…Œåº¦è¯„åˆ†ï¼ˆ0â€“1ï¼Œæ•°å€¼è¶Šé«˜ä»£è¡¨ææ…Œæƒ…ç»ªè¶Šå¼ºï¼‰
- è¾“å‡ºç»“æœå­˜å…¥æ•°æ®åº“è¡¨ **news_sentiment**

---

### (4) ææ…ŒæŒ‡æ•°è®¡ç®—æ¨¡å—

**æ–‡ä»¶è·¯å¾„ï¼š** `analysis/calculate_fear_index.py`

**è®¡ç®—é€»è¾‘ç¤ºä¾‹ï¼š**

```python
fear_index = (
    normalized_volatility * 0.5 +      # æ³¢åŠ¨ç‡å› å­ (æƒé‡50%)
    sentiment_score * 0.3 +            # æƒ…ç»ªå› å­ (æƒé‡30%)  
    abnormal_volume_ratio * 0.2        # æˆäº¤é‡å¼‚å¸¸å› å­ (æƒé‡20%)
) * 100
```

## æŒ‡æ ‡è¯´æ˜

### ğŸ§® normalized_volatilityï¼ˆæ ‡å‡†åŒ–æ³¢åŠ¨ç‡ï¼Œæƒé‡50%ï¼‰
- **æ•°æ®æ¥æºï¼š** Tushare Pro API æ—¥çº¿è¡Œæƒ…  
- **é‡‘èæ„ä¹‰ï¼š** æ³¢åŠ¨ç‡æ˜¯è¡¡é‡å¸‚åœºææ…Œçš„æ ¸å¿ƒæŒ‡æ ‡ï¼Œä»·æ ¼æ³¢åŠ¨è¶Šå¤§ï¼Œä¸ç¡®å®šæ€§è¶Šé«˜ã€‚  



### ğŸ˜Š sentiment_scoreï¼ˆæƒ…ç»ªå¾—åˆ†ï¼Œæƒé‡30%ï¼‰
- **æ•°æ®æ¥æºï¼š** èˆ†æƒ…æ•°æ® + NLPåˆ†æ  
- **é‡‘èæ„ä¹‰ï¼š** åæ˜ å¸‚åœºèˆ†è®ºæƒ…ç»ªæ³¢åŠ¨æ–¹å‘ï¼Œèƒ½æ•æ‰æŠ•èµ„è€…çš„ææ…Œæˆ–ä¹è§‚ç¨‹åº¦ã€‚  



### ğŸ“ˆ abnormal_volume_ratioï¼ˆå¼‚å¸¸æˆäº¤é‡æ¯”ç‡ï¼Œæƒé‡20%ï¼‰
- **æ•°æ®æ¥æºï¼š** Tushare æˆäº¤é‡æ•°æ® + å†å²ç»Ÿè®¡  
- **é‡‘èæ„ä¹‰ï¼š** å¼‚å¸¸é«˜æˆäº¤é‡é€šå¸¸ä¼´éšææ…Œæ€§æŠ›å”®æˆ–æç«¯æƒ…ç»ªï¼Œæ˜¯å¸‚åœºæƒ…ç»ªæç«¯åŒ–çš„é‡è¦ä¿¡å·ã€‚  

---

## (5) å¯è§†åŒ–æ¨¡å—

**æ–‡ä»¶è·¯å¾„ï¼š** `dashboard/app.py`  
**æ¡†æ¶ï¼š** Streamlit  

**åŠŸèƒ½ï¼š**
- å·¦ä¾§è¡¨æ ¼ï¼š`pandas DataFrame` æ˜¾ç¤ºï¼ˆåç§°ã€ä»£ç ã€æ¿å—ã€ä»·æ ¼ã€ææ…ŒæŒ‡æ•°ï¼‰  
- æœç´¢æ¡†ï¼šè¾“å…¥è‚¡ç¥¨ä»£ç è¿‡æ»¤æ•°æ®  
- æŠ˜çº¿å›¾ï¼š`st.line_chart` æ˜¾ç¤ºå†å²ææ…ŒæŒ‡æ•°  
- AIæ€»ç»“ï¼šä» `ai_summary` è¡¨è¯»å–æœ€æ–°ç”Ÿæˆå†…å®¹  

---

## 3. æ•°æ®åº“è®¾è®¡

| è¡¨å | è¯´æ˜ |
|------|------|
| raw_stock_data | ä» Tushare å’ŒrssæŠ“å–çš„åŸå§‹è¡Œæƒ… |
| clean_stock_data | æ¸…æ´—åçš„è¡Œæƒ…æ•°æ® |
| news_sentiment | èˆ†æƒ…æƒ…ç»ªæ•°æ®ï¼ˆnlpï¼‰ |
| fear_index | ç»¼åˆè®¡ç®—åçš„ææ…ŒæŒ‡æ•° |
| ai_summary | DeepSeek ç”Ÿæˆçš„å¸‚åœºææ…Œæ–‡å­—æ€»ç»“ |

---

## 4. æŠ€æœ¯æ ˆè¯´æ˜

| æ¨¡å— | æŠ€æœ¯ | ç†ç”± |
|------|------|------|
| è°ƒåº¦ç³»ç»Ÿ | Airflow | å¯è§†åŒ–ä»»åŠ¡ç¼–æ’ã€å®¹é”™èƒ½åŠ›å¼º |
| æ•°æ®é‡‡é›† | rss + Tushare | æ”¯æŒå¼‚æ­¥çˆ¬å–ä¸å®˜æ–¹APIè°ƒç”¨ |
| æ¸…æ´—å¤„ç† | pandas + numpy | é«˜æ•ˆETLä¸æ•°æ®è®¡ç®— |
| æ•°æ®åº“ | PostgreSQL | ç¨³å®šçš„ç»“æ„åŒ–æ•°æ®ç®¡ç† |
| NLP | PaddleNLP | æƒ…æ„Ÿåˆ†æèƒ½åŠ› |
| NLP | DeepSeek API | èˆ†æƒ…ç†è§£ |
| Webæ¡†æ¶ | Streamlit | å¿«é€Ÿæ„å»ºäº¤äº’å¯è§†åŒ–é¡µé¢ |
| æ—¥å¿—ç›‘æ§ | logging + Airflow UI | ä»»åŠ¡è¿è¡ŒçŠ¶æ€å¯è¿½è¸ª |
| ç¯å¢ƒ | conda + .env | ç¯å¢ƒéš”ç¦»ä¸æ•æ„Ÿä¿¡æ¯å®‰å…¨ |

---

## 5. Airflow DAG ä»»åŠ¡æµï¼ˆæ ¸å¿ƒï¼‰

**æ–‡ä»¶è·¯å¾„ï¼š** `airflow_dags/fear_index_pipeline.py`

```python
task_fetch = PythonOperator(task_id='fetch_data', python_callable=fetch_all_data)
task_clean = PythonOperator(task_id='clean_data', python_callable=clean_data)
task_nlp = PythonOperator(task_id='nlp_sentiment', python_callable=analyze_sentiment)
task_calc = PythonOperator(task_id='calculate_fear_index', python_callable=calculate_fear_index)
task_store = PythonOperator(task_id='store_to_db', python_callable=store_data)
task_vis = PythonOperator(task_id='generate_ai_summary', python_callable=generate_ai_summary)
task_fetch >> task_clean >> task_nlp >> task_calc >> task_store >> task_vis
```
---

## 6. æ—¥å¿—ä¸é”™è¯¯å¤„ç†

- æ‰€æœ‰ä»»åŠ¡æ—¥å¿—ç»Ÿä¸€å†™å…¥ï¼šutils/logger.py
- ä»»åŠ¡å¤±è´¥æ—¶ Airflow è‡ªåŠ¨é‡è¯• 1 æ¬¡
- æ¯æ—¥ä»»åŠ¡çŠ¶æ€é€šè¿‡ Airflow å†…ç½®é‚®ä»¶é€šçŸ¥å‘é€

---

## 7. é¡¹ç›®ç»“æ„

a_stock_fear_index/
â”œâ”€â”€ airflow_dags/
â”‚   â””â”€â”€ fear_index_pipeline.py
â”œâ”€â”€ data_pipeline/
â”‚   â”œâ”€â”€ fetch_data.py
â”‚   â”œâ”€â”€ clean_data.py
â”‚   â””â”€â”€ store_data.py
â”œâ”€â”€ analysis/
â”‚   â”œâ”€â”€ calculate_fear_index.py
â”‚   â”œâ”€â”€ nlp_sentiment.py
â”‚   â””â”€â”€ ai_summary.py
â”œâ”€â”€ dashboard/
â”‚   â””â”€â”€ app.py
â”œâ”€â”€ db/
â”‚   â”œâ”€â”€ schema.sql
â”‚   â””â”€â”€ config.py
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ logger.py
â”‚   â””â”€â”€ config_loader.py
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ README.md

---

## 8. æœªæ¥æ‰©å±•

1.å¢åŠ æ¿å—çº§ææ…ŒæŒ‡æ•°èšåˆ
2.æ¥å…¥æ¸¯è‚¡ã€ç¾è‚¡å¸‚åœº
3.å¼•å…¥æ—¶é—´åºåˆ—é¢„æµ‹æ¨¡å‹ï¼ˆProphet / LSTMï¼‰
4.äº‘ç«¯éƒ¨ç½²ï¼šAWS Lambda + RDS + Streamlit Cloud